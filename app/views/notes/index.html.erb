
<br>

<h1>
  <%= current_user.first_name %> <%= current_user.last_name %> さんの個人ページーーーーーーーーーーーーーーーーーーーーーーーーーーー
</h1>

<br>

<div class="button-container" style="display: flex; gap: 10px;">

  <%= button_to "   ⭐️ 閲覧者から見た『あなた』の公開ページ ⭐️   ",
                public_page_path(current_user.uuid, (current_user.id + 150150)),
                method: :get,
                class: "btn btn-primary",
                style: "flex: 1;" %>

  <%= button_to "   ログアウト   ", destroy_user_session_path, 
                method: :delete, 
                class: "btn btn-danger",
                style: "flex: 1;" %>

</div>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>

<div class="tabs">
  <button id="parent-tab" class="active" onclick="showSection('parent')"> Single_Note 📖 </button>
  <button id="child-tab" onclick="showSection('child')"> Family's_Note 📚 </button>
</div>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>

<!-- single_noteの小タブ -->

<div id="parent-section">
  <div class="sub-tabs">
    　◎1人で作業する<br>
    <button id="info-tab" class="active" onclick="showSubSection('info')"> ⚙️ ユーザー編集 ⚙️ </button>
    <button id="permission-tab" onclick="showSubSection('permission')"> 📓 ノートに記述 📓 </button>

    <br>
    <br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>
  </div>





 <!-- ①①①①①①①①①①①①①①① -->





  <!-- ①ユーザー編集 -->

  <div id="info-section">
  <h3> ⚙️ <%= current_user.first_name %> <%= current_user.last_name %> さんのユーザー情報 ⚙️ </h3>
  <br>

  <h3>いつでも内容を変更できます。（空欄は不可）</h3>
  <h3>ログイン時の情報・閲覧許可の対象・閲覧申請の対象として使用されます。</h3>
  <br>
    <h3>※漢字は新字体での統一を推奨します。</h3>
  <h3>※情報が少しでも異なると、親と子の紐付けが失敗します。</h3>
  <br>

   <%= form_with model: current_user, url: user_path(current_user), method: :patch, local: true do |f| %>
  <div>
    <%= f.label :email, "メールアドレス" %>
    <%= f.email_field :email, value: current_user.email, readonly: true %>
  </div>

  <div>
    <%= f.label :first_name, "苗字" %>
    <%= f.text_field :first_name, value: current_user.first_name %>
  </div>

  <div>
    <%= f.label :first_name_furigana, "苗字（ふりがな）" %>
    <%= f.text_field :first_name_furigana, value: current_user.first_name_furigana %>
  </div>

  <div>
    <%= f.label :last_name, "名前" %>
    <%= f.text_field :last_name, value: current_user.last_name %>
  </div>

  <div>
    <%= f.label :last_name_furigana, "名前（ふりがな）" %>
    <%= f.text_field :last_name_furigana, value: current_user.last_name_furigana %>
  </div>

  <div>
    <%= f.label :birthday, "生年月日" %>
    <%= f.date_select :birthday, start_year: 1900, end_year: Date.today.year, use_month_numbers: true %>
  </div>

  <div>
    <%= f.label :blood_type, "血液型" %>
    <%= f.select :blood_type, ["A", "B", "O", "AB"], include_blank: "選択してください" %>
  </div>

  <div>
    <%= f.label :phone_number, "電話番号" %>
    <%= f.text_field :phone_number, value: current_user.phone_number %>
  </div>

  <div>
    <%= f.label :address, "住所" %>
    <%= f.text_field :address, value: current_user.address %>
  </div>

  <br>
  <%= f.submit "登録情報の変更を保存" %>

  <br>
  <br>
  ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
  <br>
  <br>
  </div>
<% end %>




 <!-- ①①①①①①①①①①①①①①① -->
          <!-- 共通入力部分 -->
 <!-- ②②②②②②②②②②②②②②② -->






  <!-- ③閲覧許可 -->
  <div id="permission-section" style="display: none;">
  <h3>🏠③公開ページの閲覧を許可する対象者🏠</h3>
  <br>
  <p>※あなたを公開者（親）、許可対象を閲覧者（子）として紐付けします。</p>
  <p>※本人または許可対象者のみが、あなたの公開ページへアクセスできるようになります。</p>
  <br>
    <h3>※漢字は新字体での統一を推奨します。</h3>
  <h3>※情報が少しでも異なると、アクセス許可を付与できません。</h3>
  <br>

  <!-- ③フォーム -->
  <%= form_with model: ViewPermission.new, url: view_permissions_path, method: :post, local: true do |f| %>
    <div>
      <%= f.label :first_name, "苗字" %>
      <%= f.text_field :first_name %>
    </div>
    <div>
      <%= f.label :first_name_furigana, "苗字（ふりがな）" %>
      <%= f.text_field :first_name_furigana %>
    </div>
    <div>
      <%= f.label :last_name, "名前" %>
      <%= f.text_field :last_name %>
    </div>
    <div>
      <%= f.label :last_name_furigana, "名前（ふりがな）" %>
      <%= f.text_field :last_name_furigana %>
    </div>
    <div>
      <%= f.label :birthday, "生年月日" %>
      <%= f.date_select :birthday, start_year: 1900, end_year: Date.today.year, use_month_numbers: true %>
    </div>
    <div>
      <%= f.label :blood_type, "血液型" %>
      <%= f.select :blood_type, ["A", "B", "O", "AB"], include_blank: "選択してください" %>
    </div>
    <br>
    <%= f.submit "閲覧を許可する対象者を保存" %>
    <br><br>
    ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
    <br><br>
    
    <!-- ③ー閲覧許可対象者リスト -->
  <h3>あなたが登録した閲覧許可の対象者です。</h3>
  <% if current_user.view_permissions.any? %>
    <table border="1">
      <tr>
        <th>苗字</th>
        <th>名前</th>
        <th>生年月日</th>
        <th>血液型</th>
        <th>削除</th>
      </tr>
      <% current_user.view_permissions.each do |vp| %>
        <tr>
          <td><%= vp.first_name %> (<%= vp.first_name_furigana %>)</td>
          <td><%= vp.last_name %> (<%= vp.last_name_furigana %>)</td>
          <td><%= vp.birthday.strftime('%Y-%m-%d') %></td>
          <td><%= vp.blood_type %></td>
          <td>削除</td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <p>現在、登録されている閲覧許可対象者はありません。</p>
  <% end %>
  <br><br>
  ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
</div>

      </div>
    <% end %>
  </div>
  


  </div>
    </div>
    </div>
</div>






<!-- ファミリーズノート -->
<div id="child-section" style="display: none;">
  <div class="sub-tabs">
    　◎家族と共有する<br>
    <button id="search-tab" class="active" onclick="showChildSubSection('search')"> 🏠  "親" として利用 🏠 </button>
    <button id="result-tab" onclick="showChildSubSection('result')"> 🥳  "子" として利用 🥳 </button>
  </div>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>





  <!-- ④閲覧申請 -->





---<br>




  <div id="search-section">

  <!-- ④フォーム -->
  <%= form_with model: ViewRequest.new, url: view_requests_path, method: :post, local: true do |f| %>
      <div>
        <%= f.label :first_name, "苗字" %>
        <%= f.text_field :first_name, name: "view_request[first_name]", required: true %>
      </div>
      <div>
        <%= f.label :first_name_furigana, "苗字（ふりがな）" %>
        <%= f.text_field :first_name_furigana, name: "view_request[first_name_furigana]", required: true %>
      </div>
      <div>
        <%= f.label :last_name, "名前" %>
        <%= f.text_field :last_name, name: "view_request[last_name]", required: true %>
      </div>
      <div>
        <%= f.label :last_name_furigana, "名前（ふりがな）" %>
        <%= f.text_field :last_name_furigana, name: "view_request[last_name_furigana]", required: true %>
      </div>
      <div>
        <%= f.label :birthday, "生年月日" %>
        <%= f.date_select :birthday, prefix: "view_request", start_year: 1900, end_year: Date.today.year, use_month_numbers: true %>
      </div>
      <div>
        <%= f.label :blood_type, "血液型" %>
        <%= f.select :blood_type, ["A", "B", "O", "AB"], include_blank: "選択してください", name: "view_request[blood_type]" %>
      </div>


      <br><br>公開者（親側）から見た、

      <div>
        <%= f.label :relationship, "閲覧者（あなた）の続柄" %>
        <%= f.select :relationship, ["夫", "妻", "長男", "二男", "三男", "長女", "二女", "三女", "本人の父母", "本人の兄弟", "その他"], include_blank: "選択してください" %>
      </div>


    <br>
    <%= f.submit "閲覧したい対象者を登録する", class: "btn btn-primary" %>
<br>
<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>

  <!-- ④閲覧申請リスト -->
  <h3>あなたが登録した閲覧申請の対象者です。</h3>
  <% if current_user.view_requests.any? %>
    <table border="1">
      <tr>
        <th>苗字</th>
        <th>名前</th>
        <th>生年月日</th>
        <th>血液型</th>
        <th>削除</th>
      </tr>
      <% current_user.view_requests.each do |vr| %>
        <tr>
          <td><%= vr.first_name %> (<%= vr.first_name_furigana %>)</td>
          <td><%= vr.last_name %> (<%= vr.last_name_furigana %>)</td>
          <td><%= vr.birthday.strftime('%Y-%m-%d') %></td>
          <td><%= vr.blood_type %></td>
          <td>
            削除
          </td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <p>現在、登録されている親情報（閲覧したい対象者の情報）はありません。</p>
  <% end %>


ーーー
<h3>登録リストから公開ページURLを取得</h3>
<% current_user.view_requests.each do |request| %>
  <p>
    <strong>閲覧許可した対象者:</strong> <%= request.first_name %> <%= request.last_name %>

      <!-- URLが未取得の場合、ボタンを表示 -->
       <%= button_to "公開ページURLを取得する", request_access_view_requests_path, 
          method: :post, params: { view_request_id: request.id }, class: "btn btn-primary" %>
  </p>
<% end %>
ーーー
ーーー
<% if current_user.view_accesses_as_viewer.any? %>
  <h3>閲覧許可済みリスト</h3>
  <table border="1">
    <tr>
      <th>公開者</th>
      <th>公開ページURL</th>
    </tr>
    <% current_user.view_accesses_as_viewer.each do |access| %>
      <tr>
        <td><%= access.owner.first_name %> <%= access.owner.last_name %></td>
        <td>
          <% if access.public_page_url.present? %>
            <%= link_to "公開ページを見る", access.public_page_url, target: "_blank" %>
          <% else %>
            URL未取得
            <% end %>
          </td>
        </tr>
      <% end %>
  </table>
<% else %>
  <p>閲覧許可された公開ページはありません。</p>
<% end %>

  <br>
  ---<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>
<% end %>
<br>
</div>





  <!-- ③③③③③③③③③③③③③③③ -->
          <!-- 共通入力部分 -->
  <!-- ④④④④④④④④④④④④④④④ -->





  <div id="result-section" style="display: none;">

 <!-- ④A検索AA検索AA検索AA検索AA検索AA検索AA検索AA検索A -->

  <div id="search-section">

    <h3> 🥳 あなたが閲覧したい対象者 🥳 </h3>
    <br>
  <p>※あなたを閲覧者（子）、検索したい対象を公開者（親）として紐付けします。</p>
  <p>※検索内容と一致するユーザーが存在すると、公開ページURLを取得できます。</p>
  <p>※取得した公開ページURLにアクセスできるかは、都度チェックされます。</p>
  <br>
    <h3>※漢字は新字体での統一を推奨します。</h3>
  <h3>※情報が少しでも異なると、アクセス許可を付与できません。</h3>
  <br>

  <%= form_with model: ViewRequest.new, url: view_requests_path, method: :post, local: true do |f| %>
      <div>
        <%= f.label :first_name, "苗字" %>
        <%= f.text_field :first_name, name: "view_request[first_name]", required: true %>
      </div>
      <div>
        <%= f.label :first_name_furigana, "苗字（ふりがな）" %>
        <%= f.text_field :first_name_furigana, name: "view_request[first_name_furigana]", required: true %>
      </div>
      <div>
        <%= f.label :last_name, "名前" %>
        <%= f.text_field :last_name, name: "view_request[last_name]", required: true %>
      </div>
      <div>
        <%= f.label :last_name_furigana, "名前（ふりがな）" %>
        <%= f.text_field :last_name_furigana, name: "view_request[last_name_furigana]", required: true %>
      </div>
      <div>
        <%= f.label :birthday, "生年月日" %>
        <%= f.date_select :birthday, prefix: "view_request", start_year: 1900, end_year: Date.today.year, use_month_numbers: true %>
      </div>
      <div>
        <%= f.label :blood_type, "血液型" %>
        <%= f.select :blood_type, ["A", "B", "O", "AB"], include_blank: "選択してください", name: "view_request[blood_type]" %>
      </div>
      <div>
        <%= f.label :relationship, "検索対象から見たあなたの続柄" %>
        <%= f.select :relationship, ["夫", "妻", "長男", "二男", "三男", "長女", "二女", "三女", "本人の父母", "本人の兄弟", "その他"], include_blank: "選択してください" %>
      </div>

    <br>
    <%= f.submit "閲覧したい対象者を登録する", class: "btn btn-primary" %>
    <br>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>

  <!-- ④BリストBBリストBBリストBBリストBBリストBBリストBBリストBBリストB -->

  <h3>あなたが登録した閲覧対象者</h3>
  <% if current_user.view_requests.any? %>
    <table border="1">
      <tr>
        <th>苗字</th>
        <th>名前</th>
        <th>生年月日</th>
        <th>血液型</th>
        <th>削除</th>
      </tr>
      <% current_user.view_requests.each do |vr| %>
        <tr>
          <td><%= vr.first_name %> (<%= vr.first_name_furigana %>)</td>
          <td><%= vr.last_name %> (<%= vr.last_name_furigana %>)</td>
          <td><%= vr.birthday.strftime('%Y-%m-%d') %></td>
          <td><%= vr.blood_type %></td>
          <td>
            削除
          </td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <p>現在、登録されている親情報（閲覧したい対象者の情報）はありません。</p>
  <% end %>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>


 <!-- ④Cページ取得CCページ取得CCページ取得CCページ取得CCページ取得CCページ取得C -->

<h3>登録リストから公開ページURLを取得</h3>
<% current_user.view_requests.each do |request| %>
  <p>
    <strong>閲覧許可した対象者:</strong> <%= request.first_name %> <%= request.last_name %>

      <!-- URLが未取得の場合、ボタンを表示 -->
       <%= button_to "公開ページURLを取得する", request_access_view_requests_path, 
          method: :post, params: { view_request_id: request.id }, class: "btn btn-primary" %>
  </p>
<% end %>

<br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>


 <!-- ④DリストDDリストDDリストDDリストDDリストDDリストDDリストDDリストD -->

  <h3>URL取得済みリスト</h3>
<% if current_user.view_accesses_as_viewer.any? %>
  <table border="1">
    <tr>
      <th>公開者</th>
      <th>公開ページURL</th>
    </tr>
    <% current_user.view_accesses_as_viewer.each do |access| %>
      <tr>
        <td><%= access.owner.first_name %> <%= access.owner.last_name %></td>
        <td>
          <% if access.public_page_url.present? %>
            <%= link_to "公開ページを見る", access.public_page_url, target: "_blank" %>
          <% else %>
            URL未取得
            <% end %>
          </td>
        </tr>
      <% end %>
  </table>
<% else %>
  <p>閲覧許可された公開ページはありません。</p>
<% end %>
    <% end %>

  </div>

  <br>
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
<br>
<br>
<br>
  </div>
</div>





  <!-- ④④④④④④④④④④④④④④④ -->
          <!-- 共通入力部分 -->
  <!-- タブタブタブタブタブタブタブタブ ---------------------------------------------->





<script>
  function showSection(type) {
    if (type === 'parent') {
      // シングルのタブを表示
      document.getElementById('parent-section').style.display = 'block';
      document.getElementById('child-section').style.display = 'none';

      // タブのアクティブ状態を変更
      document.getElementById('parent-tab').classList.add('active');
      document.getElementById('child-tab').classList.remove('active');

      // ✅ 親側の最初のタブ（情報変更タブ）をデフォルト表示
      showSubSection('info');

    } else {
      // 子側のタブを表示
      document.getElementById('parent-section').style.display = 'none';
      document.getElementById('child-section').style.display = 'block';

      // タブのアクティブ状態を変更
      document.getElementById('parent-tab').classList.remove('active');
      document.getElementById('child-tab').classList.add('active');

      // ✅ 親側のタブをすべて非表示
      document.getElementById('info-section').style.display = 'none';
      document.getElementById('permission-section').style.display = 'none';
      document.getElementById('notes-section').style.display = 'none';

      // ✅ 子側の最初のタブ（検索タブ）をデフォルト表示
      showChildSubSection('search');
    }
  }

  function showSubSection(type) {
    // 親側のタブを切り替え
    document.getElementById('info-section').style.display = type === 'info' ? 'block' : 'none';
    document.getElementById('permission-section').style.display = type === 'permission' ? 'block' : 'none';
    document.getElementById('notes-section').style.display = type === 'notes' ? 'block' : 'none';

    // タブのアクティブ状態を適切に変更
    document.getElementById('info-tab').classList.toggle('active', type === 'info');
    document.getElementById('permission-tab').classList.toggle('active', type === 'permission');
    document.getElementById('notes-tab').classList.toggle('active', type === 'notes');
  }

  function showChildSubSection(type) {
    // 子側のタブを切り替え
    document.getElementById('search-section').style.display = type === 'search' ? 'block' : 'none';
    document.getElementById('result-section').style.display = type === 'result' ? 'block' : 'none';

    // タブのアクティブ状態を適切に変更
    document.getElementById('search-tab').classList.toggle('active', type === 'search');
    document.getElementById('result-tab').classList.toggle('active', type === 'result');
  }
</script>





 <!-- タブタブタブタブタブタブタブタブ --------------------------------------------->
          <!-- 共通入力部分 -->
 <!-- CSSCSSCSSCSSCSSCSSCSSCSSCSS --------------------------------------------->





<style>
  /* タブボタンの共通スタイル（通常時は薄めの黄緑） */
  .tabs button, .sub-tabs button {
    padding: 10px;
    margin: 5px;
    cursor: pointer;
    background-color: #D0F0C0; /* ✅ 通常時の薄い黄緑 */
    border: 1px solid #8BC34A; /* ✅ 縁取りは緑系 */
    color: black; /* ✅ 文字色はそのまま */
    font-weight: bold;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  /* アクティブなタブの色を #9ACD32（黄緑） */
  .tabs button.active, .sub-tabs button.active {
    background-color: #9ACD32; /* ✅ 黄緑 */
  }

  /* ホバー時の色を #556B2F（濃いオリーブグリーン）に変更 */
  .tabs button:hover, .sub-tabs button:hover {
    background-color: #556B2F; /* ✅ ダークオリーブグリーン */
  }
</style>




 <!-- CSSCSSCSSCSSCSSCSSCSSCSSCSS ------------------------------------------->
          <!-- 共通入力部分 -->
 <!-- ここが最後ですここが最後ですここが最後です ----------------------------------->